<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | L.H.E.X</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --neon: #00DFA2; --purple: #b666d2; --bg: #050505; --card: #0f0f0f; }
        body { background: var(--bg); color: #fff; font-family: 'Montserrat', sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* SIDEBAR */
        .sidebar { width: 260px; background: #000; border-right: 1px solid #222; padding: 25px; display: flex; flex-direction: column; }
        .logo { font-size: 1.8rem; font-weight: 800; color: #fff; margin-bottom: 40px; text-align: center; letter-spacing: 2px; }
        .menu-item { padding: 15px; cursor: pointer; color: #888; border-radius: 6px; margin-bottom: 10px; font-weight: 600; transition: 0.3s; }
        .menu-item:hover, .menu-item.active { background: rgba(0, 223, 162, 0.1); color: var(--neon); }

        /* MAIN */
        .main { flex: 1; padding: 40px; overflow-y: auto; background: radial-gradient(circle at top right, #111 0%, #050505 50%); }
        .tab-content { display: none; animation: fadeIn 0.5s ease; }
        .tab-content.active { display: block; }
        
        /* CARDS */
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px; }
        .card { background: var(--card); border: 1px solid #222; padding: 25px; border-radius: 12px; }
        .card-label { font-size: 0.75rem; color: #666; font-family: 'JetBrains Mono'; margin-bottom: 10px; }
        .card-val { font-size: 2.5rem; font-weight: 800; color: #fff; }
        .neon-txt { color: var(--neon); text-shadow: 0 0 15px rgba(0, 223, 162, 0.3); }

        /* UPLOAD ZONE */
        .upload-zone { border: 2px dashed #333; padding: 60px; text-align: center; border-radius: 12px; cursor: pointer; transition: 0.3s; }
        .upload-zone:hover { border-color: var(--neon); background: rgba(0,223,162,0.02); }

        /* CHAT */
        .chat-box { height: 400px; background: #0a0a0a; border: 1px solid #333; border-radius: 12px; display: flex; flex-direction: column; }
        .msgs { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; }
        .bubble { max-width: 75%; padding: 12px; border-radius: 12px; font-size: 0.9rem; }
        .in { background: #222; align-self: flex-start; }
        .out { background: rgba(0, 223, 162, 0.15); border: 1px solid var(--neon); align-self: flex-end; }
        .input-area { padding: 15px; background: #111; display: flex; gap: 10px; }
        input { flex: 1; background: #000; border: 1px solid #333; padding: 12px; color: #fff; border-radius: 6px; }
        button { background: var(--neon); border: none; padding: 0 20px; font-weight: bold; cursor: pointer; border-radius: 6px; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="logo">L.H.E.X</div>
        <div style="margin-bottom: 30px; padding: 10px; background: #111; border-radius: 8px;">
            <div style="font-size: 0.8rem; color: #888;">LOGADO COMO:</div>
            <div style="font-weight: bold;">{{ user.name }}</div>
        </div>
        <div class="menu-item active" onclick="switchTab('home', this)">üìä Vis√£o Geral</div>
        <div class="menu-item" onclick="switchTab('lazaro', this)">‚ö° Protocolo L√°zaro</div>
        <div class="menu-item" onclick="switchTab('sniper', this)">üß† Neuro-Sniper</div>
        <div class="menu-item" style="margin-top: auto; color: #ff5f56;" onclick="window.location='/logout'">üö™ Sair</div>
    </div>

    <div class="main">
        <div id="home" class="tab-content active">
            <h2 style="margin-bottom: 20px;">Painel de Controle</h2>
            <div class="grid">
                <div class="card">
                    <div class="card-label">CAPITAL RECUPERADO</div>
                    <div class="card-val neon-txt">R$ {{ "{:,.2f}".format(user.recuperado).replace(',','X').replace('.',',').replace('X','.') }}</div>
                </div>
                <div class="card">
                    <div class="card-label">STATUS DO SERVIDOR</div>
                    <div class="card-val" style="font-size: 1.5rem; color: var(--neon); margin-top: 10px;">‚óè ONLINE</div>
                </div>
            </div>
            <div class="card" style="height: 300px;"><canvas id="chart"></canvas></div>
        </div>

        <div id="lazaro" class="tab-content">
            <h2 style="margin-bottom: 20px;">Auditoria Forense</h2>
            <div class="upload-zone" onclick="document.getElementById('fileInput').click()">
                <div style="font-size: 4rem; margin-bottom: 20px;">üìÇ</div>
                <h3>ARRASTE SEUS ARQUIVOS AQUI</h3>
                <input type="file" id="fileInput" hidden onchange="runLazaro()">
            </div>
            <div id="lazaro-result" class="card" style="margin-top: 30px; display: none;">
                <div class="card-label" style="color: var(--neon);">RESULTADO</div>
                <div class="card-val neon-txt" id="lazaro-val">R$ 0,00</div>
            </div>
        </div>

        <div id="sniper" class="tab-content">
            <h2 style="margin-bottom: 20px;">Neuro-Sniper Console</h2>
            <div class="chat-box">
                <div class="msgs" id="chatMsgs">
                    <div class="bubble in">Ol√°, quero saber mais.</div>
                    <div class="bubble out">O Sniper est√° analisando...</div>
                </div>
                <div class="input-area">
                    <input type="text" id="chatInput" placeholder="Mensagem..." onkeypress="if(event.key==='Enter') sendChat()">
                    <button onclick="sendChat()">ENVIAR</button>
                </div>
            </div>
            <div id="analise-box" style="margin-top: 20px; color: #888; font-family: 'JetBrains Mono';">Aguardando Input...</div>
        </div>
    </div>

    <script>
        function switchTab(id, el) {
            document.querySelectorAll('.tab-content').forEach(d => d.classList.remove('active'));
            document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            el.classList.add('active');
        }

        function runLazaro() {
            const formData = new FormData();
            formData.append('file', document.getElementById('fileInput').files[0]);
            document.querySelector('.upload-zone').innerHTML = "<h3 style='color:var(--neon)'>PROCESSANDO...</h3>";
            
            fetch('/run_lazaro', { method: 'POST', body: formData })
            .then(res => res.json())
            .then(data => {
                document.querySelector('.upload-zone').innerHTML = "<h3>UPLOAD CONCLU√çDO</h3>";
                document.getElementById('lazaro-result').style.display = 'block';
                document.getElementById('lazaro-val').innerText = data.total;
                alert(data.msg);
                location.reload();
            });
        }

        function sendChat() {
            const input = document.getElementById('chatInput');
            const txt = input.value;
            if(!txt) return;
            document.getElementById('chatMsgs').innerHTML += `<div class="bubble in">${txt}</div>`;
            input.value = '';
            document.getElementById('analise-box').innerText = "Analisando Fator H...";
            
            fetch('/api/chat', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({msg: txt}) })
            .then(res => res.json())
            .then(data => {
                document.getElementById('analise-box').innerText = data.analise;
                setTimeout(() => {
                    document.getElementById('chatMsgs').innerHTML += `<div class="bubble out">${data.resposta}</div>`;
                }, 800);
            });
        }

        const ctx = document.getElementById('chart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b', 'Dom'],
                datasets: [{
                    label: 'Recuperado',
                    data: [10000, 15000, 20000, 28000, 35000, 42000, {{ user.recuperado }}],
                    borderColor: '#00DFA2',
                    backgroundColor: 'rgba(0, 223, 162, 0.1)',
                    fill: true
                }]
            },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { grid: { color: '#222' } }, y: { grid: { color: '#222' } } } }
        });
    </script>
</body>
</html>
